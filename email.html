<!DOCTYPE html>
<html>
<head>
	<title>Registration | Aaruush' 18</title>
</head>
<script src="https://www.gstatic.com/firebasejs/5.4.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyCsytKnhEgBEwmqajACVkxWxfqjEI3bWsU",
    authDomain: "aaruush-14a12.firebaseapp.com",
    databaseURL: "https://aaruush-14a12.firebaseio.com",
    projectId: "aaruush-14a12",
    storageBucket: "aaruush-14a12.appspot.com",
    messagingSenderId: "249314972533"
  };
  firebase.initializeApp(config);
</script>
<body>

	<label for="email">Email :	</label>

	<input type="email" name="email" placeholder="Enter your Email" id="emailID">
	<button id="submit" onclick="submitdata();">Submit!</button>

	<button id="submit" onclick="google();">gmail!</button>




<div id="table" style="display: none;">


	<label for="bookID">Booking ID</label>
	<input type="text" name="bookID" placeholder="Enter your booking ID" id="bookID">
	<button id="submit" onclick="adddata();">ADD</button>
	<br><br><br>
		
</div>

<script type="text/javascript">

	function google(){
	var provider = new firebase.auth.GoogleAuthProvider();

	firebase.auth().signInWithPopup(provider).then(function(result) {
  // This gives you a Google Access Token. You can use it to access the Google API.
  var token = result.credential.accessToken;
  // The signed-in user info.
  var user = result.user;
  // ...
}).catch(function(error) {
  // Handle Errors here.
  var errorCode = error.code;
  var errorMessage = error.message;
  // The email of the user's account used.
  var email = error.email;
  // The firebase.auth.AuthCredential type that was used.
  var credential = error.credential;
  // ...
});
}

	function submitdata() {
		var database = firebase.database();
		var email = document.getElementById('emailID').value;
		//console.log(email);
		var readRef = database.ref('/users');
		var count = 0;
		readRef.once('value',function(snapshot) {
			//console.log('email');
			
			var searchdet = snapshot.val();
			var keys = Object.keys(searchdet);
			keys.forEach(function(key) {
				console.log(searchdet[key].email);
				
				if(searchdet[key].email == email) {
					count++;
					var aid = searchdet[key].aaruushID;
					var collegename = searchdet[key].collegeName;
					var name = searchdet[key].name;
					var content = '';
					
					content+= '<h2> AID : ' + aid + '</h2>';
					content+= '<h2> College Name : ' + collegename + '</h2>';
					content+= '<h2> Name : ' + name + '</h2>';
				

					document.getElementById("table").append(content);
				}

			});

			console.log(count);
		});
	

		document.getElementById('submit').value ='';
		var xyz=document.getElementById('table');
		table.style.display="block";
}	

function adddata(){
	var database = firebase.database();
	var refa = database.ref('/users/');
	var bookID = document.getElementById('bookID').value;
	var email = document.getElementById('emailID').value;
	
	refa.once('value',function(snapshot) {

		var searchdet = snapshot.val();
		var keys = Object.keys(searchdet);
		keys.forEach(function(key) {

    		if(searchdet[key].email == email){
    	
	    		 firebase.database().ref('/users/' + key).set({
          			aaruushID: searchdet[key].aaruushID,		        
			        collegeName: searchdet[key].collegeName,
			        deviceType: searchdet[key].deviceType,			        
			        email: searchdet[key].email,
			        name: searchdet[key].name,
			        password: searchdet[key].password,
			        phoneNumber:searchdet[key].phoneNumber,
			        photoURL: searchdet[key].photoURL,
			        registrationNumber: searchdet[key].registrationNumber,
			        timestamp: searchdet[key].timestamp,
			        bookingID: bookID
     			});
	    		console.log("data added");
			}	
			else
			{
				console.log("hogaya bhai");
			}

		});
	});	
}
		
</script>



</html>